FROM python:3.13-slim

# 1) Instalar pkg-config y el metapaquete correcto para MySQL
RUN apt-get update \
  && apt-get install -y --no-install-recommends \
       pkg-config \
       default-libmysqlclient-dev \
       build-essential \
  && rm -rf /var/lib/apt/lists/*

# 2) Establecer directorio de trabajo
WORKDIR /app

# 3) Copiar requirements.txt e instalar dependencias
COPY requirements.txt .
RUN pip install --upgrade pip \
    && pip install -r requirements.txt

# 4) Copiar el resto del código y preparar la app
COPY . .

# 5) Ejecutar migraciones y colectar estáticos (opcional)
RUN python manage.py migrate --noinput
RUN python manage.py collectstatic --noinput

EXPOSE 8000
CMD ["gunicorn", "app.wsgi:application", "--bind", "0.0.0.0:8000"]
